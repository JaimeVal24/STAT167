---
title: 'Question 3: Analysis on Carrier Delays'
author: "Jamie Calencia Lopez, Jonathan Wu, Faith Ang, Melody Lu"
date: "2026-02-21"
output: html_document
---



* **3. Which airlines have the most delays?**
    * **Plan:** Compare the typical delay experience across different carriers.
    * **Methods:** Create boxplots of `dep_delay` by `carrier`. We can sort the boxplots by median in order to produce a ranking of airlines by their median delay. 
    * **Objective:** To identify which airlines are consistently late regardless of other factors.


```{r}
#new column status
hour_plot_data <- flights %>%
     mutate(status = if_else(dep_delay <= 0, "On-time", "Delayed")) %>%
     filter(!is.na(status))

flights_delayed <- filter(hour_plot_data, status == "Delayed")

#geom boxplot with departure delay between airplane carriers
ggplot(data = flights_delayed, mapping = aes(x = dep_delay, fill = carrier)) +
  geom_boxplot() 
```

```{r, fig.height= 7}
#using hour_plot_data to see how many plane trips belonged to each carrier
ggplot(data = hour_plot_data) +
  geom_bar(mapping = aes(x = carrier, fill = carrier)) +
  geom_text(stat = "count", aes(x = carrier, label = after_stat(count)), vjust = -1)
```


```{r, fig.height= 7}
#using hour_plot_data to see bargraph of planes that were on time or delayed
ggplot(data = hour_plot_data) +
  geom_bar(mapping = aes(x = status, fill = carrier)) +
  geom_text(stat = "count", aes(x = status, label = after_stat(count)), vjust = 0) +
  facet_wrap(~ carrier, nrow = 2)
```

```{r, fig.height= 7}
#using hour_plot_data to see bargraph of carriers that were most delayed
ggplot(data = flights_delayed) +
  geom_bar(mapping = aes(x = carrier, color = carrier, fill = carrier)) +
  geom_text(stat = "count", aes(x = carrier, label = after_stat(count)), vjust = 0) 
  
```

```{r, echo = F, message=FALSE, warning=FALSE, fig.height= 7}
 ggplot(hour_plot_data, aes(x = status, fill = carrier)) +
     geom_density(alpha = 0.5)+
    facet_wrap(~ carrier, nrow = 2)
```

```{r, echo = F, message=FALSE, warning=FALSE}

flight_proportions <- flights %>%
  filter(!is.na(dep_delay)) %>% # Remove flights with missing delay info (likely cancelled)
  group_by(carrier) %>%
  summarise(
    total_flights = n(),
    delayed_flights = sum(dep_delay > 0, na.rm = TRUE), # Count delayed flights
    proportion_delayed = delayed_flights / total_flights # Calculate the proportion
  ) %>%
  arrange(desc(proportion_delayed)) # Sort by proportion_delayed in descending order

# View the result
print(flight_proportions)
```

```{r, echo = F, message=FALSE, warning=FALSE, fig.height= 7}

# Plot the proportion of delayed flights by carrier
ggplot(data = flight_proportions, aes(x = carrier, y = proportion_delayed)) +
  geom_bar(stat = "identity", fill = "lightblue") + # Use 'identity' stat as y-values are pre-calculated
  labs(
    title = "Proportion of Delayed Flights by Carrier",
    x = "Carrier",
    y = "Proportion Delayed"
  ) +
  geom_text(aes(label = sprintf("%.2f", proportion_delayed))) +
  scale_y_continuous(labels = scales::percent) + # Format y-axis as percentage
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5)) # Center the plot title


```


```{r, echo = F, message=FALSE, warning=FALSE, fig.height= 7}

# Plot the proportion of delayed flights by carrier
ggplot(data = flight_proportions, aes(x = reorder(carrier, -proportion_delayed), y = proportion_delayed)) +
  geom_bar(stat = "identity", fill = "lightblue") + # Use 'identity' stat as y-values are pre-calculated
  labs(
    title = "Proportion of Delayed Flights by Carrier",
    x = "Carrier",
    y = "Proportion Delayed"
  ) +
  geom_text(aes(label = sprintf("%.2f", proportion_delayed))) +
  scale_y_continuous(labels = scales::percent) + # Format y-axis as percentage
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5)) # Center the plot title


```
